<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="SpaceStyleSheet.css">

    <title>Common Room</title>

    <style>
        .header {
            grid-area: hd;
        }

        .timerBox {
            grid-area: tbx;

            font-size: 10px;

            text-align: center;
            background-color: rgba(211, 211, 211, 0.1);

            border: thick;
            border-color: pink;

            padding: 3%;

            margin-left: 5%;
            margin-right: 5%;
            margin-top: 3%;
            margin-bottom: 3%;
        }

        .interactionBox {
            grid-area: ibx;
            text-align: center;
            background-color: rgba(211, 211, 211, 0.1);
            border: thick;
            border-color: pink;
            margin-left: 5%;
            margin-right: 5%;
            margin-top: 3%;
            margin-bottom: 3%;
            padding-top: 5px;
            padding-bottom: 5px;
        }

        .wrapper {

            color: white;


            margin: auto;
            margin-top: 50px;
            padding-top: 10px;

            gap: 10px;
        }

        .txtBxBtn {

            background-color: lightgray;
        }

        #start {

            background-color: black;
            color: white;
            text-align: center;

        }

        .col2 {

            background-image: "images/Room1.png";
        }
    </style>
</head>

<body>
    <div id="wrapper">

        <div id="col1">

            <!--This is the div that controls the light-->
            <div id="light"></div>

            <h1 id="title">Starbound Quest</h1>


            <!-- The main photo  -->
            <div id="backgroundImg" class="showMe">
                <img class="centre" src="images/Room1.png" style="width:90%;" alt="Common Room" />
            </div>

            <div id="backgroundImgPostWire" class="hideMe">
                <img class="centre" src="images/room1_no_coil.png" style="width:90%;" alt="Common Room" />
            </div>

            <div id="postIt" class="hideMe">

                <div class="ptNote">

                    <p id=PCode></p>

                </div>

            </div>

            <!-- Different endings -->
            <div id="airlockImg" class="hideMe">
                <img class="centre" src="images/Airlock.png" style="width:90%;" alt="Airlock Endcard" />
            </div>
        </div>


        <div id="col2" class="showMe">

            <div class="header">

                <h1>Common Room</h1>

                <!--These methods are the wrong way round -->
                <button id="goToRoom3" onclick="goToRoom3()">Electricity Room</button>
                <button id="goToRoom2" onclick="goToRoom2()">Ship Deck</button>

            </div>

            <div class="timerBox">

                <h1>Time Remaining: <span id="timerText">?</span></h1>


            </div>

            <div class="interactionBox">


                <p id="textOutput"> Computer: You should probably find a way to restore power to get this door working.</p>
                <div id="unlcoked" class="hideMe">Electricity Room Unlocked</div>

                <div id="wireDiv"><button id="Wire" class="showMe" onclick="Wire()">Pick Up Wire</button></div>
                <button id="door2" class="showMe" onclick="door2()">Examine Pin Pad</button>
                <button id="airlock" class="showMe" onclick="airlock()">Try Airlock</button>
                <button id="stickyNote" class="showMe" onclick="getRandNo()">Look At Sticky Note</button>
               
                <form id="inputForm" class="hideMe" onsubmit="unlockDoor2()">
                    <!------------------------------------------------THIS IS NEWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW-->

                    <input type="text" id="word-input">
                    <!--input id="text" type="text" name="userInput"-->
                    
                    <!-- <input class="button" id="submit" type="submit">-->

                </form> 
                <button id="submit" class="hideMe" onclick="unlockDoor2()">Submit</button><br>
                <button id="back" class="hideMe" onclick="back()">Back</button>
            </div>

        </div>
    </div>

    <script>
        let Permission = 0;

        let myNum = sessionStorage.getItem("Torch")
        myNum = Number(myNum);
        console.log("Torch is " + myNum);
        if (myNum == 1) {
            //turns off the light
            var div = document.getElementById("light");
            div.setAttribute("id", "newDivID");
        }

        //torch
        var pos = document.documentElement;
        pos.addEventListener('mousemove', e => {
            pos.style.setProperty('--x', e.clientX + 'px')
            pos.style.setProperty('--y', e.clientY + 'px')
        })

        function startingText() {

            document.getElementById("textOutput").innerHTML = "Computer: You should probably find a way to get this door working";
        }

        function textUpdateShipDeck() {

            document.getElementById("textOutput").innerHTML = "Carry on to the Ship Deck";
        }

        function textUpdateStickyNote() {

            document.getElementById("textOutput").innerHTML = " ";
        }

        function textUpdateLookAroundPostTorch() {

            document.getElementById("textOutput").innerHTML = "Looking Around You see the outline of 2 doors <br> an airlock <br> and a ...'add other item here'";
        }

        function textUpdateDoor1Locked() {

            document.getElementById("textOutput").innerHTML = "Door is Locked! You may need to override the locking mechanism with an overdose of electricity if you can find any?";
        }

        function textUpdateDoor2Locked() {

            document.getElementById("textOutput").innerHTML = "Locked - Pin is Required to Open Door";
        }

        function textUpdateDoor2Unlocking() {

            document.getElementById('textOutput').innerHTML = "Please Enter Pin";
        }

        function textUpdateDoor2Unlocked() {

            //document.getElementById('textOutPut').innerHTML = "Door 2 Unlocked";
        }

        function textUpdateAirlock() {

            document.getElementById("textOutput").innerHTML = "Well done, you chose death, Goodbye!";
        }

        function textUpdateTurnOn() {

            document.getElementById("textOutput").innerHTML = "Torch On Successfully";
            document.getElementById("textOutput").innerHTML = "I suggest you begin looking around.";
        }
        //===========================================================================================================
        //===========================================================================================================
        //===========================================================================================================

        function Wire() {
            sessionStorage.setItem("WireCoil", 1);
            let wirenum = sessionStorage.getItem("WireCoil");
            console.log("(Should be 1) Wire number = " + wirenum);

            document.getElementById("textOutput").innerHTML = "Add Wire to Inventory";

            document.getElementById('wireDiv').className = "hideMe";

            document.getElementById('backgroundImg').className = "hideMe";
            document.getElementById('backgroundImgPostWire').className = "showMe";


        }
        //Go to Room 3, not room 2 (The method is named wrong )
        function goToRoom2() {

            if (sessionStorage.getItem("shipDeck") == 1) {
                window.location.replace("3ShipDeck.html")
            }
        }

        //Go to Room 2, not room 3 (The method is named wrong )
        function goToRoom3() {
 
            let ElectricPerm = sessionStorage.getItem("Rom2permission");
            console.log("Electric Perm = " + ElectricPerm);
            if (ElectricPerm == 1) {
                console.log("Successs")
                window.location.replace("2ElectricityRoom.html");
            } else {
                console.log("Fail")
                document.getElementById("textOutput").innerHTML = "Locked, Pin Required";
            }
        }

        function door2() {

            textUpdateDoor2Unlocking();

            var a = document.getElementById("inputForm");
            var b = document.getElementById("wire");
            var c = document.getElementById("door1");
            var d = document.getElementById("door2");
            var e = document.getElementById("airlock");


            a.style.display = "initial";

            document.getElementById('Wire').className = "hideMe";
            //document.getElementById('door1').className = "hideMe";
            document.getElementById('door2').className = "hideMe";
            document.getElementById('airlock').className = "hideMe";
            document.getElementById('submit').className = "showMe";
            document.getElementById('back').className = "showMe";
            document.getElementById('stickyNote').className = "hideMe";


        }

        var doorCode;

        function unlockDoor2() {
            console.log("HAS BEEN CALLELD")
            let num = document.getElementById("word-input").value;
            console.log("num = myRand");
            console.log(num);
            console.log(myRand);

            if (num == myRand) {
                document.getElementById('unlcoked').className = "showMe";
                console.log("YES ITS THE SAME")
                door2Status = 1;
                textUpdateDoor2Unlocked();

                document.getElementById('submit').className = "hideMe";
                document.getElementById('inputForm').className = "hideMe";
                sessionStorage.setItem("Rom2permission", '1');
                Permission = 1;
            }
        }

        function airlock() {

            textUpdateAirlock();
            window.location.replace("Airlock_ending.html")

            var e = document.getElementById("airlock");
            e.style.display = "none";
        }

        function back() {

            document.getElementById('backgroundImg').className = "showMe";
            document.getElementById('postIt').className = "hideMe";

            document.getElementById('back').className = "hideMe";


            document.getElementById('submit').className = "hideMe";
            document.getElementById('airlock').className = "showMe";
            document.getElementById('door2').className = "showMe";
            document.getElementById('Wire').className = "showMe";
            document.getElementById('stickyNote').className = "showMe";
            document.getElementById('inputForm').classname = "hideMe";

            var a = document.getElementById("inputForm");
            a.style.display = "none";

            startingText();

        }


        let myRand;
        let x;
        sessionStorage.setItem("NewCode", 0);

        function getRandNo() {
            document.getElementById('backgroundImg').className = "hideMe";
            document.getElementById('backgroundImgPostWire').className = "hideMe";
            document.getElementById('postIt').className = "showMe";
            document.getElementById('back').className = "showMe";
            document.getElementById('submit').className = "hideMe";
            document.getElementById('airlock').className = "hideMe";
            document.getElementById('door2').className = "hideMe";
            document.getElementById('Wire').className = "hideMe";
            document.getElementById('stickyNote').className = "hideMe";



            let url = 'http://andymcdowell.hosting.hal.davecutting.uk/1030_APIs/randomCode.php?length=4';

            fetch(url)
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    console.log("P CODE");
                    myRand = data.secretCode;
                    doorcode = myRand;
                    console.log("MyRand " + myRand);

                    sessionStorage.setItem("stickyNoteValue", myRand);
                    document.getElementById("PCode").innerHTML = myRand;
                    textUpdateStickyNote();
                })
                .catch(function (error) {
                    console.error('ERROR: ' + error);
                });
        }


        var locked = 0;

        function unlockDoor() {

            function textUpdateIncorrectPin() {

                document.getElementById("textOutput").innerHTML = "Incorrect Pin, Please Try Again!";

            }

            function textUpdateCorrectPin() {

                document.getElementById("textOutput").innerHTML = "Correct Pin, Door Now Open";

            }

        }

        ////Methods Yet to Be Written
        ///
        /*addWireToInventory(){
            implement session Storage for Room 2


        }
            */
        //
        ////




        //Session scripts
        // Initial timer (default vaulue is 1000 seconds)
        if (!sessionStorage.getItem('timeRem')) {
            sessionStorage.setItem('timeRem', '1000');
        }

        // Timer with the remaining time
        function startTimer() {
            var timeRem = sessionStorage.getItem('timeRem');
            document.getElementById('timerText').innerHTML = timeRem;
            timer = setInterval(countdown, 1000);
        }

        // Save the remaining time in the session storage before navigating to another page
        function saveTimeRem() {
            var timeRem = document.getElementById('timerText').innerHTML;
            sessionStorage.setItem('timeRem', timeRem);
        }

        // Load the remaining time from the session storage and start the timer with it
        function loadTimeRem() {
            var timeRem = sessionStorage.getItem('timeRem');
            document.getElementById('timerText').innerHTML = timeRem;
            timer = setInterval(countdown, 1000);
        }

        // Update the timer display and store the remaining time in the session storage every second
        function countdown() {
            var timeRem = document.getElementById('timerText').innerHTML;
            if (timeRem > 0) {
                timeRem--;
                document.getElementById('timerText').innerHTML = timeRem;
                sessionStorage.setItem('timeRem', timeRem);
            } else {
                clearInterval(timer);
                document.getElementById('timerText').innerHTML = 'END';
                timeRem = 10;
                // Redirect to statistics page
                //turned off for development
                //window.location.href = 'stats.html';
            }
        }

        // Register a beforeunload event listener to save the remaining time before navigating away from the page
        window.addEventListener('beforeunload', saveTimeRem);

        // Load the remaining time and start the timer when the page loads
        window.addEventListener('load', loadTimeRem);

        window.onload = function () {
            var fontSize = sessionStorage.getItem("fontSize");
            if (fontSize) {
                document.getElementById("wrapper").style.fontSize = fontSize;
            }
        }


        //Session storage - Accessibility
        var textSize = sessionStorage.getItem('text');
        document.getElementById("wrapper").style.fontSize = textSize

        var modeColor = sessionStorage.getItem('mode');
        if (modeColor == 'light') {
            lightMode();
        }

        function lightMode() {
            document.getElementById("wrapper").style.backgroundColor = "rgb(216, 216, 216)";
            document.getElementById("col1").style.color = "black";
            document.getElementById("col2").style.color = "black";
        }

        



    </script>




</body>

</html>