<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starbound Quest - Control Room</title>

    <link rel="stylesheet" href="SpaceStyleSheet.css">

</head>

<body>
    <div id="wrapper">
        <!-- Column 1 - Where the photo is  -->
        <div id="col1">
            <h1>Starbound Quest</h1>

            <!-- The main photo  -->
            <div id="main" class="showMe">
                <img class="centre" src="images/room6_gasandfire.png" style="width:90%;" alt="Control Room" />
            </div>

            <div id="gas" class="hideMe">
                <img class="centre" src="images/room6_gas.png" style="width:90%;" alt="Control Room" />
            </div>

            <div id="normal" class="hideMe">
                <img class="centre" src="images/room6.png" style="width:90%;" alt="Control Room" />
            </div>

            <!--Screen close-up-->
            <div id="screen" class="hideMe">
                <img class="centre" src="images/locked_screen.png" style="width:90%;" alt="Control Room" />
            </div>

            <div id="unlocked_screen" class="hideMe">
                <img class="centre" src="images/unlocked_screen.png" style="width:90%;" alt="Control Room" />
            </div>

            <!-- Different endings -->
            <div id="saveShip" class="hideMe">
                <img class="centre" src="images/escape endcard.jpg" style="width:90%;" alt="Escape Endcard" />
            </div>

            <div id="runOutOfTime" class="hideMe">
                <img class="centre" src="images/escape endcard.jpg" style="width:90%;" alt="Escape Endcard" />
            </div>
        </div>

        <!-- column 2 - where the buttons go -->
        <div id="col2" class="showMe">

            <h1>Control Room</h1>

            <h1>Time Remaining: <span id="timerText">?</span></h1>

            <div id="RoomButtons">
                <button id="previousRoom" onclick="previousRoom()" class="button">Previous Room</button>
            </div>
            <audio id="myAudio">
                <source src="Audio/space-atmospheric-background-124841.mp3" type="audio/mpeg">
            </audio>
            <div id="audio">
                <button onclick="playAudio()" type="button">Play Audio</button>
                <button onclick="pauseAudio()" type="button">Pause Audio</button>
            </div>

            <div id="Room6Buttons">

                <div id="arrival">
                    <p>Computer: “You have reached the source of the gas leak! You must hurry to find a way to stop it
                        before you run
                        out of oxygen and the fire spreads further causing an explosion!”</p>
                </div>

                <div id="orderInstruction" class="hideMe">
                    <p>Computer: "You should put the fire out first"</p>
                </div>

                <div id="needExtingusher" class="hideMe">
                    <p>Computer: "You do not have anything to put the fire out with"</p>
                </div>

                <div id="fireStopped" class="hideMe">
                    <p>Computer: "Fire has been successfully put out"</p>
                </div>

                <div id="screenInstruction" class="hideMe">
                    <p>Computer: "You must log in to gain access to manage the ship's systems"</p>
                </div>

                <div id="riddleInstruction" class="hideMe">
                    <p>Here's your password hint (1 Word).</p>
                </div>

                <div id="gasOffText" class="hideMe">
                    <p>Computer: "You managed to turn off the gas and start up the filtration program to remove the gas
                        from the
                        ship."</p>
                </div>
                <div id="needToPutOutFire" class="hideMe">
                    <p>Computer: "You need to put out the fire before you can reach the screen."</p>
                </div>

                <div id="Riddle" class="hideMe">
                    <p id="riddle-question"></p>
                    <input type="text" id="guess" placeholder="Password">
                    <button onclick="checkAnswer()">Enter</button>
                    <p id="result" style="display: none;"></p>
                    <p id="riddle-answer" style="display: none;"></p>
                    <p></p>
                </div>
                <!-- 
                <button id="screenbutton" onclick="screen()" disabled class="button">Check
                    out screen</button> -->
                <button id="screenbutton" onclick="screen()" class="button">Check
                    out screen</button>
                <button id="fire" onclick="fire()" class="button">Put out fire</button>
                <button id="riddle" onclick="riddle()" class="hideMe">Enter Password</button>
                <button id="back" onclick="back()" class="hideMe">Back</button>
                <button id="turnOff" onclick="turnOff()" class="hideMe">Turn off gas</button>
                <button id="end" onclick="end()" class="hideMe">Next</button>

            </div>
        </div>
    </div>


    <script>
        let extinguisher = sessionStorage.getItem('extinguisher');

        function fire() {

            if (extinguisher == 1) {
                document.getElementById('fireStopped').className = "showMe";
                document.getElementById('gas').className = "showMe";
                document.getElementById('main').className = "hideMe";
                document.getElementById('arrival').className = "hideMe";
                document.getElementById('needToPutOutFire').className = "hideMe";
                document.getElementById('fire').className = "hideMe";
                enableButton();
                sessionStorage.setItem('fireOut', '1');
            } else {
                document.getElementById('arrival').className = "hideMe";
                document.getElementById('needExtingusher').className = "showMe";
                document.getElementById('needToPutOutFire').className = "hideMe";
            }
        }

        window.addEventListener('load', loadTimeRem)

        window.onload = function () {
            var fontSize = sessionStorage.getItem("fontSize");
            if (fontSize) {
                document.body.style.fontSize = fontSize;
            }
        }

        window.addEventListener('load', function () {
            if (sessionStorage.getItem('fireOut') !== null) {
                fireOut = parseInt(sessionStorage.getItem('fireOut'));
                if (fireOut === 1) {
                    document.getElementById('fireStopped').className = "showMe";
                    document.getElementById('gas').className = "showMe";
                    document.getElementById('main').className = "hideMe";
                    document.getElementById('arrival').className = "hideMe";
                    document.getElementById('fire').className = "hideMe";
                    enableButton();

                }

            }
        }
        );


        function enableButton() {
            const screenOrderButton = document.getElementById("screenbutton");
            screenOrderButton.disabled = false;
            sessionStorage.setItem("FireChecker", 1);

        }

        function screen() {

            let checker = 0;
            let temp = sessionStorage.getItem("FireChecker");
            if (temp == 1) {
                checker = temp;
            }
            console.log(checker);
            if (checker === 0) {
                console.log("Echecking")
                //document.getElementById('orderInstruction').className = "showMe";
                document.getElementById('needToPutOutFire').className = "showMe";
                document.getElementById('orderInstruction').className = "hideMe";
                document.getElementById('needExtingusher').className = "hideMe";
                document.getElementById('arrival').className = "hideMe";
                return;
            } else {
                console.log("ERRORROROROOR")

                document.getElementById('main').className = "hideMe";
                document.getElementById('gas').className = "hideMe";
                document.getElementById('screen').className = "showMe";
                document.getElementById('screenbutton').className = "hideMe";
                document.getElementById('fire').className = "hideMe";
                document.getElementById('fireStopped').className = "hideMe";
                document.getElementById('riddle').className = "showMe";
                document.getElementById('riddle').className = "button";
                document.getElementById('back').className = "showMe";
                document.getElementById('back').className = "button";
                document.getElementById('arrival').className = "hideMe";
                document.getElementById('screenInstruction').className = "showMe";
            }
        }


        function back() {
            document.getElementById('gas').className = "showMe";
            document.getElementById('screen').className = "hideMe";
            document.getElementById('screenbutton').className = "showMe button";
            document.getElementById('fire').className = "hideMe";
            document.getElementById('riddle').className = "hideMe";
            document.getElementById('back').className = "hideMe";
            document.getElementById('Riddle').className = "hideMe";
            document.getElementById('arrival').className = "hideMe";
            document.getElementById('screenInstruction').className = "hideMe";
            document.getElementById('riddleInstruction').className = "hideMe";


        }

        const riddles = [
            {
                question: "What has a heart that doesn't beat?",
                answer: "Artichoke",
            },
            {
                question: "What has a head and a tail, but no body?",
                answer: "Coin",
            },
            {
                question: "What starts with an E, ends with an E, but only contains one letter?",
                answer: "Envelope",
            },
            {
                question: "The poor have me; the rich need me. Eat me and you will die. What am I?",
                answer: "Nothing",
            },
            {
                question: "I have branches but no fruit, trunk, or leaves. What am I?",
                answer: "Bank",
            },
            {
                question: "What word contains all of the twenty-six letters?",
                answer: "Alphabet",
            },
            {
                question: "What travels around the world, but stays in the corner?",
                answer: "Stamp",
            },
            {
                question: "What is always spelt wrong?",
                answer: "Wrong",
            },
            {
                question: "What has many words but never speaks?",
                answer: "Book",
            },
            {
                question: "What color can you eat?",
                answer: "Orange",
            },
            {
                question: "They come at night without being called and are lost in the day without being stolen. What are they?",
                answer: "Stars",
            },
            {
                question: "I touch the earth and I touch the sky, but if I touch you, you’ll likely die. What am I?",
                answer: "Lightning",
            },
            {
                question: "I’m tall when I’m young, and I’m short when I’m old. What am I?",
                answer: "Candle",
            },
            {
                question: "What is always in front of you but can’t be seen?",
                answer: "Future",
            },
            {
                question: " I shave every day, but my beard stays the same. What am I?",
                answer: "Barber",
            }
            // Add more riddles here...
        ];

        let currentRiddle;

        function getRandomRiddle() {
            const randomIndex = Math.floor(Math.random() * riddles.length);
            return riddles[randomIndex];
        }

        function checkAnswer() {
            const guessElement = document.getElementById("guess");
            const resultElement = document.getElementById("result");
            const answerElement = document.getElementById("riddle-answer");

            if (guessElement.value.toLowerCase() === currentRiddle.answer.toLowerCase()) {
                document.getElementById('screen').className = "hideMe";
                document.getElementById('unlocked_screen').className = "showMe";
                document.getElementById('back').className = "hideMe";
                document.getElementById('previousRoom').className = "hideMe";
                document.getElementById('Riddle').className = "hideMe";
                document.getElementById('turnOff').className = "showMe button";
                document.getElementById('riddleInstruction').className = "hideMe";


            } else {
                resultElement.textContent = "Incorrect. Try again!";
                resultElement.style.color = "red";
            }

            guessElement.value = "";
            resultElement.style.display = "block";
        }

        function generateRiddle() {
            const riddle = getRandomRiddle();
            const questionElement = document.getElementById("riddle-question");
            const answerElement = document.getElementById("riddle-answer");

            questionElement.textContent = riddle.question;
            answerElement.textContent = riddle.answer;

            return riddle;
        }

        currentRiddle = generateRiddle(); // Initialize with a random riddle

        function riddle() {
            document.getElementById('arrival').className = "hideMe";
            document.getElementById('screenInstruction').className = "hideMe";
            document.getElementById('riddleInstruction').className = "showMe";
            document.getElementById('Riddle').className = "showMe";
            document.getElementById('riddle').className = "hideMe";
        }

        function turnOff() {
            document.getElementById('unlocked_screen').className = "hideMe";
            document.getElementById('normal').className = "showMe";
            document.getElementById('turnOff').className = "hideMe";
            document.getElementById('gasOffText').className = "showMe";
            document.getElementById('end').className = "showMe button";
        }

        function end() {
            window.location.replace("Successful-ending.html")
        }

        function previousRoom() {
            window.location.replace("4Gallery.html")
        }

        //Session scripts
        // Initial timer (default vaulue is 1000 seconds)
        if (!sessionStorage.getItem('timeRem')) {
            sessionStorage.setItem('timeRem', '1000');
        }

        // Timer with the remaining time
        function startTimer() {
            var timeRem = sessionStorage.getItem('timeRem');
            document.getElementById('timerText').innerHTML = timeRem;
            timer = setInterval(countdown, 1000);
        }

        // Save the remaining time in the session storage before navigating to another page
        function saveTimeRem() {
            var timeRem = document.getElementById('timerText').innerHTML;
            sessionStorage.setItem('timeRem', timeRem);
        }

        // Load the remaining time from the session storage and start the timer with it
        function loadTimeRem() {
            var timeRem = sessionStorage.getItem('timeRem');
            document.getElementById('timerText').innerHTML = timeRem;
            timer = setInterval(countdown, 1000);
        }

        // Update the timer display and store the remaining time in the session storage every second
        function countdown() {
            var timeRem = document.getElementById('timerText').innerHTML;
            if (timeRem > 0) {
                timeRem--;
                document.getElementById('timerText').innerHTML = timeRem;
                sessionStorage.setItem('timeRem', timeRem);
            } else {
                clearInterval(timer);
                document.getElementById('timerText').innerHTML = 'END';
                timeRem = 10;
                window.location.href = 'Timer_ending.html';
            }
        }

        // Register a beforeunload event listener to save the remaining time before navigating away from the page
        window.addEventListener('beforeunload', saveTimeRem);

        // Load the remaining time and start the timer when the page loads
        window.addEventListener('load', loadTimeRem);

        window.onload = function () {
            var fontSize = sessionStorage.getItem("fontSize");
            if (fontSize) {
                document.body.style.fontSize = fontSize;
            }
        }

        //Session storage - Accessibility
        var textSize = sessionStorage.getItem('text');
        document.getElementById("wrapper").style.fontSize = textSize

        var modeColor = sessionStorage.getItem('mode');
        if (modeColor == 'light') {
            lightMode();
        }

        function lightMode() {
            document.getElementById("wrapper").style.backgroundColor = "rgb(216, 216, 216)";
            document.getElementById("col1").style.color = "black";
            document.getElementById("col2").style.color = "black";
        }

        var audio = document.getElementById("myAudio");

        function playAudio() {
            audio.play();
        }

        function pauseAudio() {
            audio.pause();
        }

    </script>
</body>

</html>