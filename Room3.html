<!DOCTYPE html>
<html>

<head>

    <title>Ship Deck</title>

    <link rel="stylesheet" href="SpaceStyleSheet.css">

    <style>

    </style>
</head>

<body>
    <div id="wrapper">

        <!-- Column 1 - Where the photo is  -->
        <div id="col1">
            <h1>Ship Deck</h1>

            <!-- The main photo  -->
            <div id="room3" class="showMe">
                <img class="centre" src="images/Room3.png" style="width:90%;" alt="Photo of the Ship Deck" />
            </div>

            <!-- Memory Game  -->
            <div class="memoryGame hideMe">
                <div id="score">0</div>
                <br><br>
                <div class="colourGreen AllColours"></div>
                <div class="colourRed AllColours"></div>
                <div class="colourBlue AllColours"></div>
                <div class="colourYellow AllColours"></div>
            </div>
        </div>


        <!-- column 2 - where the buttons go -->
        <div id="col2">
            <h1>Room 3</h1>
            <div id="RoomButtons">
                <button id="previousRoom" onclick="previousRoom()">Previous Room</button>
                <button id="nextRoom" onclick="nextRoom()">Next Room</button>
            </div>
            <h4>What do you want to do?</h4>
            <br>
            <div id="options">
                <p id="output" class="hideMe">Probably dont need</p>
                <button onclick="crowbarDoor();" class="button">Try crowbar on door</button>
                <button onclick="crowbarPickup();" class="button">Pick up crowbar</button>
                <button onclick="lever();" class="button">Flick Lever</button>
                <button onclick="setupGame();" id="podium" class="button">Examine podium</button>
                <button onclick="" class="button">Try crowbar on door</button>
            </div>
        </div>
    </div>

    <script>
        let crowbar = 0;
        function nextRoom() {
            if (score >= 7) {
                window.location.replace("Room4.html")
            } else {
                alert("You need to do the memory game first.")
            }
        }

        function previousRoom() {
            window.location.replace("Room1.html")
        }

        function crowbarPickup() {
            crowbar = 1;
            window.alert("You picked up the crowbar.");
        }

        function crowbarDoor() {
            if (crowbar == 1) {
                window.alert("You run towards the door at full speed swinging your crowbar and when you get to the door you swing the crowbar as hard as you can and it bounces offâ€¦ it hits you in your head, you feel dizzy.");

            } else {
                window.alert("You do not have the crowbar in your inventory.");
            }

        }

        function lever() {
            window.alert("Aww a cute little spinglespop appears. You should name it!");


        }

        const scoreValue = document.getElementById("score");
        const AllColours = document.querySelectorAll(".AllColours");
        const options = document.getElementById("options");
        const PodiumButton = document.querySelector("#podium");
        const output = document.querySelector("#output");
        const memoryGame = document.querySelector(".memoryGame");
        const room3Pic = document.getElementById("room3")
        const colours = {
            colourGreen: {
                currentColour: "#19581b",
                new: "#1fbf24",
            },
            colourRed: {
                currentColour: "#630e0e",
                new: "#d42020",
            },
            colourBlue: {
                currentColour: "#202257",
                new: "#262bc7",
            },
            colourYellow: {
                currentColour: "#7a7a14",
                new: "#dbdb39",
            },
        };
        let randomColours = [];
        let randomizer = false;
        let ClickNum, score = 0;

        //
        function setupGame() {
            score = 0;
            ClickNum = 0;
            randomColours = [];
            randomizer = false;
            memoryGame.classList.remove("hideMe");
            options.className ="hideMe";
            room3Pic.className = "hideMe";
            randomizerGenerate();
        };
        //Function to decide the sequence
        function randomizerGenerate() {
            randomColours.push(generateRandomValue(colours));
            score = randomColours.length;
            randomizer = true;
            randomizerSequence(score);
        };

        //Function to get a random value from object
        function generateRandomValue(obj) {
            let arr = Object.keys(obj);
            return arr[Math.floor(Math.random() * arr.length)];
        };

        //Function to play the sequence
        async function randomizerSequence(score) {
            scoreValue.innerText = score;
            for (let i of randomColours) {
                let currentColours = document.querySelector(`.${i}`);
                await delay(500);
                currentColours.style.backgroundColor = `${colours[i]["new"]}`;
                await delay(600);
                currentColours.style.backgroundColor = `${colours[i]["currentColour"]}`;
                await delay(400);
            }
            randomizer = false;
        };


        //Delay for blink effect
        async function delay(time) {
            return await new Promise((resolve) => {
                setTimeout(resolve, time);
            });
        }
        //When user click on the colours
        AllColours.forEach((element) => {
            element.addEventListener("click", async (e) => {
                //if user clicks the same colour then next level
                if (randomizer) {
                    return false;
                }
                if (e.target.classList[0] == randomColours[ClickNum]) {
                    //colour blick effect on click
                    e.target.style.backgroundColor = `${colours[randomColours[ClickNum]]["new"]
                        }`;
                    await delay(500);
                    e.target.style.backgroundColor = `${colours[randomColours[ClickNum]]["currentColour"]
                        }`;
                    //User click
                    ClickNum += 1;
                    //Next level if number of valid clicks == score
                    if (ClickNum == score && score != 7) {
                        ClickNum = 0;
                        randomizerGenerate();
                    }
                    if (score == 7) {
                        alert("Woo you won")
                        memoryGame.className = "hideMe";
                    }

                } else {
                    lose();
                }
            });
        });
        // Function when player executes wrong sequence
        const lose = () => {
            output.innerHTML = `<span> Your Score: </span> ${score}`;
            output.classList.remove("hideMe");
            options.className = "showMe";
            room3Pic.className = "showMe";
            memoryGame.classList.add("hideMe");
            // podiumButton.innerText = "Play Again";
            podiumButton.classList.remove("hideMe");
            
        };
    </script>
</body>

</html>